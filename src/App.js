import React, { useState, useEffect } from "react";
import GenderSelection from "./GenderSelection";
import AgeQuestion from "./AgeQuestion";
import ProgressPage from "./ProgressPage";
import ProgressBar from "./ProgressBar";
import Header from "./Header";
import SendForm from "./SendForm";
import ResultMessage from "./ResultMessage";
import "./App.css";
// import QuoteComponent from "./QuoteComponent";
import SelectableOptions from "./SelectableOptions";
import ninety from "./images/ninety.webp";
import atitude from "./images/atitude.webp";
import great from "./images/great-job.webp";
import almost from "./images/almost.89489eb9422adf3186ae.webp";
// import habits from "./images/habits.cc39320a45ee8b5d463b.webp";
import gotThis from "./images/got_this.46c739f11ad2bc0f8902.webp";
import power from "./images/willpower.96f0924c2e52b676557f.webp";
// import loading from "./images/‚ÄîPngtree‚Äîimage icon - vector loading_4979442.png";
// import { FaStar } from "react-icons/fa";

function App() {
  const [step, setStep] = useState(1);
  const totalSteps = 30;
  const [responses, setResponses] = useState([]);
  const [userName, setUserName] = useState("");

  useEffect(() => {
    if (step === 30) {
      window.fbq("track", "Lead");
    }
  }, [step]);

  const handleBackButtonClick = () => {
    if (step > 1) {
      setStep(step - 1);
    }
  };

  const handleGenderSelect = (gender) => {
    console.log(`G√™nero selecionado: ${gender}`);
    setStep(2);
  };

  const handleAgeSubmit = (age) => {
    console.log(`Idade selecionada: ${age}`);
    setStep(4);
  };

  // const handleQuoteComponent = (answer) => {
  //   console.log(`Resposta selecionada: ${answer}`);
  //   setStep(step + 1);
  // };

  // FUNCIONAMENTO DO SELECT V√ÅRIOS + SISTEMA DE PONTUA√á√ÉO

  const handleSelectionChange = (selectedOptions) => {
    setResponses((prevResponses) => {
      const newResponses = [...prevResponses];
      newResponses[step - 19] = selectedOptions; // Ajuste o √≠ndice conforme necess√°rio
      return newResponses;
    });
  };

  const calculateResult = () => {
    const scoreMap = {
      Nunca: 0,
      Raramente: 1,
      "√Äs vezes": 2,
      Frequentemente: 3,
      Sempre: 4,
    };

    const totalScore = responses.flat().reduce((acc, option) => {
      if (option && option.label in scoreMap) {
        return acc + scoreMap[option.label];
      }
      return acc;
    }, 0);

    if (totalScore <= 10) {
      return "Baixos N√≠veis de Dopamina";
    } else if (totalScore <= 20) {
      return "Baixos N√≠veis de Aten√ß√£o";
    } else if (totalScore <= 30) {
      return "Altos N√≠veis de Ansiedade";
    } else {
      return "Comportamentos Saud√°veis";
    }
  };

  const handleFormSubmit = (name) => {
    setUserName(name);
    setStep(30);
    // window.fbq("track", "Lead");
  };

  const handleContinue = () => {
    console.log("Continuar...");
    setStep(step + 1);
  };

  const skipAll = () => {
    setStep(29);
  };

  return (
    <div className="App">
      <div className="container">
        <Header
          curStep={step}
          totStep={totalSteps}
          onBackButtonClick={handleBackButtonClick}
          showBackButton={step !== 1 && step !== 29 && step !== 30}
        />
        <ProgressBar currentStep={step} />
        {step === 1 && <GenderSelection onGenderSelect={handleGenderSelect} />}
        {step === 2 && (
          <ProgressPage
            title="Estamos orgulhosos de voc√™!"
            subtitle={
              <>
                das pessoas ainda n√£o come√ßaram sua jornada de
                autoaperfei√ßoamento, portanto,{" "}
                <strong>voc√™ j√° est√° um passo √† frente</strong>
              </>
            }
            image={ninety}
            onContinue={skipAll}
          />
        )}
        {step === 3 && <AgeQuestion onAgeSubmit={handleAgeSubmit} />}
        {step === 4 && (
          <SelectableOptions
            question="Voc√™ se sente motivado ao iniciar novas tarefas ou projetos ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 5 && (
          <SelectableOptions
            question="Voc√™ experimenta prazer e satisfa√ß√£o com suas atividades di√°rias ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 6 && (
          <SelectableOptions
            question="Voc√™ sente necessidade de recompensas r√°pidas, como doces ou redes sociais, para se sentir bem ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 7 && (
          <SelectableOptions
            question="Voc√™ se sente energizado ap√≥s atividades f√≠sicas ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 8 && (
          <SelectableOptions
            question="Voc√™ tem dificuldade em manter um humor positivo ao longo do dia ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 9 && (
          <ProgressPage
            title="Avalia√ß√£o do n√≠vel de aten√ß√£o"
            undertitle={
              <>
                O pr√≥ximo grupo de perguntas ir√° ajudar a entender o seu n√≠vel
                de aten√ß√£o.
                <br />
                <strong>Pronto para continuar?</strong>
              </>
            }
            image={atitude}
            onContinue={handleContinue}
          />
        )}
        {step === 10 && (
          <SelectableOptions
            question="Voc√™ consegue manter o foco em uma tarefa por um longo per√≠odo ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 11 && (
          <SelectableOptions
            question="Voc√™ se distrai facilmente em ambientes barulhentos ou movimentados ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 12 && (
          <SelectableOptions
            question="Voc√™ sente dificuldade em finalizar tarefas importantes ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 13 && (
          <SelectableOptions
            question="Voc√™ procrastina frequentemente tarefas que considera dif√≠ceis ou tediosas ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 14 && (
          <SelectableOptions
            question="Voc√™ tem facilidade em se concentrar em um √∫nico projeto por v√°rias horas ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 15 && (
          <ProgressPage
            title="√ìtimo trabalho at√© agora"
            undertitle="Voc√™ est√° indo bem. A pr√≥xima parte do question√°rio se concentrar√° no seu n√≠vel de anseidade."
            image={great}
            onContinue={handleContinue}
          />
        )}

        {step === 16 && (
          <SelectableOptions
            question="Voc√™ se sente ansioso ou preocupado com frequ√™ncia?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 17 && (
          <SelectableOptions
            question="Voc√™ tem dificuldade para relaxar e se desligar das preocupa√ß√µes di√°rias ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 18 && (
          <SelectableOptions
            question="Voc√™ experimenta sintomas f√≠sicos de ansiedade, como palpita√ß√µes ou sudorese ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 19 && (
          <SelectableOptions
            question="Voc√™ sente que sua ansiedade interfere nas suas atividades di√°rias ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 20 && (
          <SelectableOptions
            question="Voc√™ consegue manter a calma em situa√ß√µes de estresse ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}

        {step === 21 && (
          <ProgressPage
            title="Quase L√°!"
            undertitle="Agora, vamos nos aprofundar em seu estilo de vida para elaborar um plano que se adapte perfeitamente a voc√™!"
            subtitle="Obrigado por ser honesto. Cada resposta que voc√™ d√° nos ajuda a personalizar seu plano"
            image={almost}
            onContinue={handleContinue}
          />
        )}

        {step === 22 && (
          <SelectableOptions
            question="Voc√™ pratica atividades f√≠sicas regularmente ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 23 && (
          <SelectableOptions
            question="Voc√™ mant√©m uma alimenta√ß√£o equilibrada e saud√°vel ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 24 && (
          <SelectableOptions
            question="Voc√™ dedica tempo para hobbies ou atividades que gosta ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}

        {step === 25 && (
          <SelectableOptions
            question="Voc√™ sente que tem um bom equil√≠brio entre trabalho e vida pessoal ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}
        {step === 26 && (
          <SelectableOptions
            question="Voc√™ dorme bem e acorda sentindo-se descansado ?"
            options={[
              { label: "‚ùå Nunca" },
              { label: "üòê Raramente" },
              { label: "ü§î √Ås vezes" },
              { label: "üôÇ Frequentemente" },
              { label: "‚úÖ Sempre" },
            ]}
            multiple={false}
            onSelectionChange={handleSelectionChange}
            onContinue={handleContinue}
          />
        )}

        {step === 27 && (
          <ProgressPage
            title="Voc√™ conseguiu!"
            subtitle="dos usu√°rios com respostas semelhantes melhoraram sua autodisciplina, e voc√™ tamb√©m pode"
            image={gotThis}
            onContinue={handleContinue}
          />
        )}
        {step === 28 && (
          <ProgressPage
            title="Pronto para ver seu plano?"
            subtitle="Sabemos que √†s vezes as coisas ficam complicadas, por isso projetamos o Dopamina dolares para funcionar com apenas 5 minutos do seu tempo dedicado a ele todos os dias! Pequenas mudan√ßas levam a grandes resultados"
            image={power}
            onContinue={handleContinue}
          />
        )}
        {step === 29 && <SendForm onSubmit={handleFormSubmit} />}

        {step === 30 && (
          <ResultMessage result={calculateResult()} userName={userName} />
        )}
      </div>
    </div>
  );
}

export default App;
